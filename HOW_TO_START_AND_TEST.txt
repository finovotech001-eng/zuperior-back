╔═══════════════════════════════════════════════════════════════════════════════╗
║                                                                               ║
║                    HOW TO START BACKEND AND TEST DEPOSITS                     ║
║                                                                               ║
╚═══════════════════════════════════════════════════════════════════════════════╝

CURRENT STATUS:
---------------
✅ Frontend running on http://localhost:3000
✅ Prisma client regenerated with new MT5Transaction columns
✅ Enhanced console logging added to manual deposit controller
❌ Backend server NOT running yet

DATABASE STATUS:
----------------
- 0 MT5Transaction records (verified by running verify script)
- This is expected - no deposits created with new code yet


═══════════════════════════════════════════════════════════════════════════════
                              STEP-BY-STEP GUIDE
═══════════════════════════════════════════════════════════════════════════════

STEP 1: START BACKEND SERVER
-----------------------------

Option A - Double-click this file:
   📁 quick-start-backend.bat

Option B - Use terminal:
   1. Open a NEW Command Prompt or PowerShell window
   2. Run these commands:
      
      cd "D:\CRM Dashboard\zuperior-back"
      npm start

⚠️  IMPORTANT: Do NOT close your frontend terminal! Open a NEW one for backend.


STEP 2: WAIT FOR BACKEND TO START
----------------------------------

You'll see messages like:
   ✅ Database connected successfully
   ✅ Server running on port 5000
   ✅ Routes loaded successfully


STEP 3: CREATE A MANUAL DEPOSIT
--------------------------------

1. Open your browser: http://localhost:3000/deposit
   (or click on the deposit page in your frontend)

2. Fill in the form:
   ✓ Select your MT5 account from dropdown
   ✓ Enter amount: 100 (or any amount)
   ✓ Enter transaction hash: TEST123 (or any text you want)
   ✓ Upload proof file (optional)

3. Click "Submit" or "Create Deposit" button


STEP 4: WATCH BACKEND CONSOLE
------------------------------

In the backend terminal, you'll see DETAILED LOGS:

   ═══════════════════════════════════════════════════════════
   🚀 NEW MANUAL DEPOSIT REQUEST RECEIVED
   ═══════════════════════════════════════════════════════════
   📥 Request body: {
     "mt5AccountId": "12345678",
     "amount": 100,
     "transactionHash": "TEST123"
   }
   
   📋 Extracted data:
      - User ID: your-user-id
      - MT5 Account ID: 12345678
      - Amount: 100
      - Transaction Hash: TEST123      ← YOUR HASH!
      - Proof File URL: file-url       ← YOUR FILE!
   
   🔄 Creating MT5Transaction record...
   📊 MT5Transaction data: { ...full data... }
   
   ✅✅✅ MT5Transaction CREATED SUCCESSFULLY! ✅✅✅
   📋 MT5Transaction ID: uuid-here
   📋 MT5Transaction full record: {
     "id": "...",
     "type": "Deposit",
     "amount": 100,
     "currency": "USD",
     "status": "pending",
     "transactionId": "TEST123",    ← STORED!
     "depositId": "...",
     "userId": "...",
     ...
   }


STEP 5: VERIFY IN DATABASE
---------------------------

Run this command in a terminal:

   cd "D:\CRM Dashboard\zuperior-back"
   node verify-mt5-transaction.js

You should see:
   📊 Found 1 MT5Transaction records
   Transaction #1:
     Amount: 100
     Status: pending
     Transaction ID: TEST123       ← YOUR HASH!
     Deposit ID: ...
     User ID: ...


═══════════════════════════════════════════════════════════════════════════════
                                  TROUBLESHOOTING
═══════════════════════════════════════════════════════════════════════════════

IF YOU SEE ERROR IN BACKEND CONSOLE:
-------------------------------------

❌❌❌ FAILED TO CREATE MT5Transaction! ❌❌❌
❌ Error: [exact error message]

Common errors and solutions:

1. "Unknown arg `depositId`"
   → Prisma client not regenerated
   → Solution: Stop server, run "npx prisma generate", restart

2. "Column 'depositId' does not exist"
   → Migration not applied
   → Solution: Run "npx prisma migrate deploy"

3. "Foreign key constraint"
   → MT5Account doesn't exist
   → Solution: Create MT5 account first from frontend


IF NO LOGS APPEAR IN CONSOLE:
------------------------------

1. Check backend is actually running (should see "Server running on port 5000")
2. Check you're submitting to correct endpoint
3. Check browser console for errors
4. Verify you're authenticated (logged in)


═══════════════════════════════════════════════════════════════════════════════
                                   QUICK TEST
═══════════════════════════════════════════════════════════════════════════════

1. Double-click: quick-start-backend.bat
2. Wait for "Server running on port 5000"
3. Go to: http://localhost:3000/deposit
4. Create deposit with transaction hash "TEST123"
5. Watch backend console for success message
6. Run: node verify-mt5-transaction.js
7. See your MT5Transaction record!


═══════════════════════════════════════════════════════════════════════════════

THAT'S IT! The transaction hash and file will be stored in the database
automatically when you create a deposit!

═══════════════════════════════════════════════════════════════════════════════


